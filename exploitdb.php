<?php
/*
Plugin Name: ExploitDB
Plugin URI: https://github.com/SystemOveride/ExploitDB
Description: Find and show the exploit from database of exploit-db.com
Author: SYSTEM_OVERIDE aka Luca Gagliardi
Version: 0.1
Author URI: http://systemoveride.net/
*/ 

/**
 *      exploitdb.php
 *      
 *      Copyright 2011 System_Overide aka Luca Gagliardi
 *      
 *      This program is free software; you can redistribute it and/or modify
 *      it under the terms of the GNU General Public License as published by
 *      the Free Software Foundation; either version 2 of the License, or
 *      (at your option) any later version.
 *      
 *      This program is distributed in the hope that it will be useful,
 *      but WITHOUT ANY WARRANTY; without even the implied warranty of
 *      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *      GNU General Public License for more details.
 *      
 *      You should have received a copy of the GNU General Public License
 *      along with this program; if not, write to the Free Software
 *      Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston,
 *      MA 02110-1301, USA.
 **/


class exploitdb extends WP_Widget{
	
	function exploitdb(){
				
		$widget_ops = array('classname' => 'exploitdb', 'description' => 'Find and show exploit from database exploit-db.com');
		$this->WP_Widget('exploitdb', 'Show Exploit', $widget_ops);
	}
	
	
	function form($instance){
		
		$instance = wp_parse_args( (array) $instance);
		                                                    
		$arr = array('Remote', 'Local', 'Web', 'DoS', 'Shell', 'Papers');
		$cont = count($arr);
		
		foreach($arr as $key){
			?>
			<label for="<?php echo $this->get_field_id($key); ?>"</label>
			<?php echo $key."\n"; ?><input id="<?php echo $this->get_field_id($key); ?>" name="<?php echo $this->get_field_name($key); ?>" value="<?php echo strip_tags($instance[$key]); ?>" />
			<?php echo "<br><br>"; ?>
			
			<?php
		} ?>
		
		<label for="<?php echo $this->get_field_id('chose'); ?>"><?php _e('Show Form?:'); ?></label>
		<select id="<?php echo $this->get_field_id('chose');?>" name="<?php echo $this->get_field_name('chose');?>"
		<option value='si' <?php if($instance['chose'] == 'si'){echo 'selected=\"selected\"';}?>>si</option>
		<option value='no' <?php if($instance['chose'] == 'no'){echo 'selected=\"selected\"';}?>">no</option>
     	</select>

		<?php 
	}		
		
	
	function widget($args, $instance){
		extract($args);
		
		$instance['chose'] = $instance['chose'];
		$title = (empty($instance['title'])) ? "ExploitDB" : strip_tags($instance['title']);
		if($title){
			echo $before_title . $title . $after_title;
		}
		show_search($instance['chose']);		
		show_exploitdb('Remote', $instance['Remote'], "http://www.exploit-db.com/remote/");
		show_exploitdb('Local', $instance['Local'], "http://www.exploit-db.com/local/");
		show_exploitdb('Web', $instance['Web'], "http://www.exploit-db.com/webapps/");
		show_exploitdb('DoS', $instance['DoS'], "http://www.exploit-db.com/dos/");
		show_exploitdb('Shell', $instance['Shell'], "http://www.exploit-db.com/shellcode/");
		show_exploitdb('Papers', $instance['Papers'], "http://www.exploit-db.com/papers/");
	}
}

function connect($ur){
	$ch = curl_init();
	curl_setopt ($ch, CURLOPT_URL, $ur);
	curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
	$result = curl_exec($ch);
	curl_close($ch);
	
	return $result;
}

function show_exploitdb($nome, $num, $st){
	
	
	if($num>25){
		$num = 25;
	}
	
	if(!$num == (int)$num){
		$num = 0;
	}
	
	$result = connect($st);
		
	$preg = '#\<td class=\"list_explot_description\">(.*?)\</td\>#si';
	
	
	if(preg_match_all($preg, $result, $matches)){
		if($num != 0){
			echo "<br><br><b><center>$nome</center></b><br>";
		}
		for($i=0;$i<$num;$i++){
			echo $matches[0][$i]."<br><br>";
		}
	}
	else{
		echo "Error";
	}
}
	

function show_search($yn){
	if($yn == "no"){
		echo "";
	}
	else{
		echo "<br><br><form action=\"\" method=\"post\">
		Search Exploit <input type=\"text\" name=\"explsearch\">
		<br><br>
		<input type=\"submit\" value=\"Find Exploit\">
		<br><br>
		</form>";
		show_exploit_search();
	 }
 }
 
function show_exploit_search(){
	$preg = '#\<td class=\"list_explot_description\">(.*?)\</td\>#si';
	if(isset($_POST['explsearch']) && $_POST['explsearch'] != ""){
		
		$expl = $_POST['explsearch'];
		
		$url = "http://www.exploit-db.com/search/?action=search&filter_page=1&filter_description=$expl&filter_exploit_text=&filter_author=&filter_platform=0&filter_type=0&filter_lang_id=0&filter_port=&filter_osvdb=&filter_cve=";
		$result = connect($url);
		
		if(preg_match_all($preg, $result, $matches)){
			for($i=0;$i<6;$i++){
				echo $matches[0][$i]."<br><br>";
			}
		}
	 	else{
			echo "<br>Exploit not found";
		}
	}
}

			
function reg_exploitdb(){
	register_widget("exploitdb");
}

add_action("init", "reg_exploitdb", 1);

?>
